<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bronya – 丰富连接的创意网络</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        html { background:#fff; scroll-behavior:smooth; }
        * { margin:0; padding:0; box-sizing:border-box; }
        body {
            font-family: Tahoma, sans-serif;
            background:#faf0e6;
            color:#022450;
            line-height:1.6;
            padding:20px;
        }
        h1 { font-size:2rem; text-align:center; margin:1.5rem 0 .5rem; }
        h2 { font-size:1.5rem; text-align:center; margin:1.5rem 0 .8rem; color:#1a936f; }
        p  { max-width:70ch; margin:1rem auto; text-align:center; }

        .visualization {
            width: 960px;
            max-width: 100%;
            margin: 2rem auto;
            background:#fffaf0;
            border:1px solid #ddd;
            border-radius:1rem;
            overflow:hidden;
            box-shadow:0 4px 15px rgba(0,0,0,.1);
            padding:1.5rem;
        }
        #node-link-diagram { height: 680px; }
        #adjacency-matrix { height: auto; }

        /* Node-Link 样式 */
        .link {
            stroke:#999; stroke-opacity:.7; stroke-width:2.5px;
            transition: stroke .2s;
        }
        .link.branch {
            stroke:#ff6b6b; stroke-width:3px; stroke-dasharray:5,5;
        }
        .node circle {
            cursor:pointer; transition:all .25s ease;
        }
        .node.central circle {
            fill:#4ecdc4; stroke:#1a936f; stroke-width:4px; r:38;
        }
        .node.branch circle {
            fill:#ffe66d; stroke:#ffa502; stroke-width:3px; r:28;
        }
        .node text {
            font-weight:600; font-size:14px; fill:#022450;
            text-anchor:middle; dominant-baseline:central; pointer-events:none;
        }
        .node.central text { font-size:18px; font-weight:700; fill:#fff; }

        /* 邻接矩阵 */
        #matrix-container { overflow-x:auto; margin-top:1rem; }
        table {
            width:100%; border-collapse:collapse; margin:0 auto;
            font-size:14px; background:white;
        }
        th, td {
            border:1px solid #ccc; padding:8px 12px; text-align:center;
            min-width:60px; font-weight:600;
        }
        th {
            background:#4ecdc4; color:white; font-weight:700;
            position:sticky; top:0; z-index:10;
        }
        th:first-child, td:first-child {
            background:#f0f0f0; font-weight:700; position:sticky; left:0; z-index:9;
        }
        .cell-1 { background:#d4edda; color:#155724; font-weight:bold; }
        .cell-0 { background:#f8f9fa; color:#6c757d; }

        @media (max-width: 768px) {
            .visualization { padding:1rem; }
            #node-link-diagram { height:520px; }
            th, td { padding:6px 8px; font-size:13px; min-width:50px; }
        }
    </style>
</head>
<body>
    <header>
        <h1>Bronya 的创意生态网络</h1>
        <p>
            不仅展示 Bronya 与 6 个领域的连接，<strong>还包含领域之间的交叉协作</strong>（用虚线表示）。
            下方自动生成更丰富的 <strong>邻接矩阵</strong>。
        </p>
    </header>

    <section class="visualization" id="node-link-diagram"></section>

    <section class="visualization" id="adjacency-matrix">
        <h2>邻接矩阵（含交叉连接）</h2>
        <div id="matrix-container"></div>
    </section>

    <script>
        /* ==================== 数据（含交叉连接） ==================== */
        const data = {
            nodes: [
                { id: "Bronya",               group: "central" },
                { id: "BA Creative Media\nCityU SCM", group: "branch" },
                { id: "插画\nIllustration",  group: "branch" },
                { id: "电影\nFilmmaking",    group: "branch" },
                { id: "绘画\nPainting",      group: "branch" },
                { id: "雕塑\nSculpture",     group: "branch" },
                { id: "摄影\nPhotography",  group: "branch" }
            ],
            links: [
                // Bronya → 所有
                ...["BA Creative Media\nCityU SCM", "插画\nIllustration", "电影\nFilmmaking",
                    "绘画\nPainting", "雕塑\nSculpture", "摄影\nPhotography"].map(t => ({
                    source: "Bronya", target: t, type: "main"
                })),
                // 交叉连接（用虚线表示）
                { source: "插画\nIllustration", target: "绘画\nPainting", type: "branch" },
                { source: "插画\nIllustration", target: "摄影\nPhotography", type: "branch" },
                { source: "电影\nFilmmaking", target: "摄影\nPhotography", type: "branch" },
                { source: "电影\nFilmmaking", target: "绘画\nPainting", type: "branch" },
                { source: "绘画\nPainting", target: "雕塑\nSculpture", type: "branch" },
                { source: "雕塑\nSculpture", target: "摄影\nPhotography", type: "branch" },
                { source: "摄影\nPhotography", target: "BA Creative Media\nCityU SCM", type: "branch" },
                { source: "插画\nIllustration", target: "BA Creative Media\nCityU SCM", type: "branch" }
            ]
        };

        const width  = 960;
        const height = 680;

        /* ==================== Node-Link 图 ==================== */
        const svg = d3.select("#node-link-diagram")
            .append("svg")
            .attr("viewBox", `0 0 ${width} ${height}`)
            .attr("preserveAspectRatio", "xMidYMid meet");

        const simulation = d3.forceSimulation(data.nodes)
            .force("link", d3.forceLink(data.links).id(d => d.id).distance(d => d.type === "branch" ? 140 : 190))
            .force("charge", d3.forceManyBody().strength(-620))
            .force("center", d3.forceCenter(width/2, height/2))
            .force("collide", d3.forceCollide().radius(d => d.group==="central"? 60:48));

        const link = svg.append("g")
            .selectAll("line")
            .data(data.links)
            .join("line")
            .attr("class", d => "link " + (d.type === "branch" ? "branch" : ""));

        const node = svg.append("g")
            .selectAll("g")
            .data(data.nodes)
            .join("g")
            .attr("class", d => "node " + d.group);

        node.append("circle")
            .attr("r", d => d.group==="central"? 38:28);

        node.append("text")
            .text(d => d.id)
            .attr("dy", d => d.group==="central"? 5:4);

        const drag = d3.drag()
            .on("start", d => { if (!d3.event.active) simulation.alphaTarget(.3).restart(); d.fx = d.x; d.fy = d.y; })
            .on("drag",  d => { d.fx = d3.event.x; d.fy = d3.event.y; })
            .on("end",   d => { if (!d3.event.active) simulation.alphaTarget(0); d.fx = null; d.fy = null; });
        node.call(drag);

        simulation.on("tick", () => {
            link.attr("x1", d => d.source.x).attr("y1", d => d.source.y)
                .attr("x2", d => d.target.x).attr("y2", d => d.target.y);
            node.attr("transform", d => `translate(${d.x},${d.y})`);
        });

        // 初始布局
        const branchCount = data.nodes.length - 1;
        const angleStep = 2 * Math.PI / branchCount;
        data.nodes.forEach((n, i) => {
            if (n.group === "central") {
                n.x = width / 2; n.y = height / 2;
            } else {
                const angle = (i - 1) * angleStep - Math.PI / 2;
                n.x = width / 2 + 230 * Math.cos(angle);
                n.y = height / 2 + 230 * Math.sin(angle);
            }
        });
        simulation.restart();

        // 悬停放大
        node.select("circle")
            .on("mouseenter", function() { d3.select(this).attr("r", d => d.group==="central"? 44:34); })
            .on("mouseleave", function() { d3.select(this).attr("r", d => d.group==="central"? 38:28); });

        /* ==================== 自动生成邻接矩阵 ==================== */
        const nodeIds = data.nodes.map(d => d.id);
        const n = nodeIds.length;
        const matrix = Array(n).fill().map(() => Array(n).fill(0));

        data.links.forEach(link => {
            const i = nodeIds.indexOf(link.source.id || link.source);
            const j = nodeIds.indexOf(link.target.id || link.target);
            if (i !== -1 && j !== -1) {
                matrix[i][j] = 1;
                matrix[j][i] = 1; // 无向图
            }
        });

        const tableHTML = `
            <table>
                <thead>
                    <tr><th></th>${nodeIds.map(id => `<╎<th title="${id}">${id.split('\n')[0]}</th>`).join('')}</tr>
                </thead>
                <tbody>
                    ${matrix.map((row, i) => `
                        <tr>
                            <td>${nodeIds[i].split('\n')[0]}</td>
                            ${row.map(val => `<td class="cell-${val}">${val}</td>`).join('')}
                        </tr>
                    `).join('')}
                </tbody>
            </table>
        `;

        d3.select("#matrix-container").html(tableHTML);
    </script>
</body>
</html>